SignatureVisibleType = {
    ONLY_TEXT: 1,
    BOTH: 2,
    ONLY_IMAGE: 3
};
var _signBox, _pdfPage, _signImage, _signText, _posX, _posY, _signWidth, _signHeigth, _defaultImage = "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACc1BMVEUAAABGRl1KUFNKUFNLUVVLUFRNUVVLUFRVVVVKUFNLUFRKUFNMT1RLUVNKT1VIUFhMT1NLUFNOTk5KUFRMUVVLUFRKT1VKT1NLUFRLUVRMT1NMUFVAYGBLUFRLUFRAQEBLUFRLUFRLT1RJSUlLTlJLUFRLS1pMUFRLUFNLUFRMUFRKUVVLUFRMU1NLUFRLUFRLUVRLUFRMUFRMUVNLUFRLT1RLUFRKUVRJUFRLUFNKUFRMT1RKUVdJUlJLUFRLUVRKUFVLT1RLUFRLUFVLUFRLUFRNUlJNTVlKVVVEVVVNTU1VVVWAgIBLUFVMT1VMT1RLUFNOTlhLUFRLUFRLUFVLTlVMT1NLUFRMT1VOTllMUFRMUVFNUVVLUFQzZmZLUFRJUVVQUFBVVVVLT1NMUFVLUFRLT1QAAABMUFRNTVNLUVVNTVVMUFVMUFVMT1NJSVtKT1RLT1NKUVVVVVVNTVVLUVFLUFRLT1NHVVVLUFRKTlNKUFVLUVRMUFRKUVRKUVRLUFRLUFRLUVRLUFRRUVFLUFVLUFNKUFNLUFNLT1RLUFRKUFVLT1RLT1RLT1RLUVROTlVMUFRJUlJKUFRKT1RLT1RLUFRKUVVLUFRMUFRJUFdHUlJKT1RLUFNLUFRKUFRLUFRJUlJLUFRLUFRLUFRLT1RMTFVNU1NLUFRMUVRKUFRLUVNLUFRLUFVITlVKUFVLUVROTlNKUFVMUFRLUFRNUlJLUFNLUVRKT1NMUVRLUFVKUVNLUFRLUVVPT1hKUFNJT1VLT1NMUVNLUFRMUFNLUFRKTlJKUlJJTlNLUFRLUFVMT1VLUFRLUFRLUFRLUFQAAADa8LodAAAAz3RSTlMAC1mNwfI/3QaQ/uKUXy0gh5kNhjn8WjeCrko2CNqjBP3C1wdB7BGA38hAda0l+3NYqXll4KfVTEnWwGEmHJ2OXeftaX34NRQYDwoMArtUkVwa7vYzTor6VxfpLzz1BfBCEAlErLCkAbMrex5sb00OZEdIAyEs84QS+TRg1NjRT6DPq7wTZtyo2Zr0svc9OogkvTh/Z7fleMZ2IxmXn5K5vzvo4ZV6GyjFW4li5s0nyuQuMIPrMpxVcZvTa4x+HVYqgWjbosk+HzFtuMeq4+pXMtrjAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+IDHgsAAGxrpbQAAAPVSURBVFjD1Zf9X1NVHMc/MMA5UWKyQYVsyKCBOh+iqIQSyZgwpZwPWQhumOtJKMiMDEwlKkWkKLJEwLKyB1PStGft0Z4//1Ln7u5ud3O723W9Xunnh3u+33vP933PPfd+z/leQFZGpiErmykqO8uQmYEo5cxINVjRjBxVuHGmibNyZ8/JS1FzZufOommmMQy4gcw3Q5fM+eRcxSmw0AoUFt14kx6ElZabZat4HktgM9jJUl2DKOH8sqDhYHkFbiGdrNQFqChnVdBYwIVY5OLiJToBWMjFwXYpl+FWVkM3YBlvC7a3swYGGvQD7uCdwfYuLketoU4/oEoMW9LdvCfYXjVgBettaQGKV7IhLQDu5ar7ogCNbrd7tWjL3CE1CafZ3ZgI4FnD7LUqQIuUbZb78cA6JfW86+FYRbYkAKCxktwQAWyUYjY9iM0PhReAh9G6hdyYCIC2lvatqkcw+3w+v2htvpCkxC3zxSasCpDea7wGAR3bHomSwYba7RF3biAZ4NHYBfQxPK5265IBnnhyR5Q6ga6nIu7T18Ekpg3wd3RLcrQBdd1h5fQAz8jmziSAbaHZzoX/WdXk78JzvSHzeW3A7hf6JPXvAV7sC2tvBzz7ZHP/wLU+if8/4KXBapVeBta+EnFfTQGwNCqT2ovlRTKkek9ygLG1SqXNQE9BxB24LibxPwCYtzYU9qQBcBwQ030wKSEhYOcQnftdPBQvqGnYsTopIJdZbeJw+MrwkdcspGnv60kAWRwF3uCbV8QvEfvjmFNsvG9pA45wBfC2KB5j9M4BrhkBjpbQ5NAEHOY4cIwTrTYE1B0mOSX7+XR6tADH+a4H79HEE+9Xl34Qvl68iaHF0Ozlh1oATzmHR5TksYavF3ClYp7kR1oAfGxZ/wkpyotPRXHS3n7KFzybw3ql65SoDDW/RD+Oe0s+23K67ow0iN684MlmO2UDxmxOI4VcEKVVxudCSnFVyX2ycZbnbKkAYvWFi+e7xP3PWngBVwPAl3Z6T06Jf7NxxAPsYb9WdM94EVoHpTk5dwGZX4mh1PDrqB557NX6cfqGY0Cg1rp82iYV6BPAt2Lzi9Igt9sSxov/kwXo+k58QAOj3+MiXZfEy9wQ3eeQnf0//BhHNeILnuBPRvwsPf0O/hJAKScx3BB7v4vrGF/DuOQStys08Vfgslck2292dsYZ59Hfj/0RR+ebRSKd8gf+5F9SryKOZbQd5DwjUtciaUvZxaHLktP0N0/MFyc6dQAqJv+Riosi2bMK01V+ekQHQKh2iGeaQvYR0qEvWtJuZ7diTveNKua/ykKBgkauYAcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDMtMzBUMTE6MDA6MDArMDI6MDDZZlSaAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAzLTMwVDExOjAwOjAwKzAyOjAwqDvsJgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",
    _imagePrefix = "data:image/png;base64,",
    _pageWidth = 0,
    _pageHeight = 0,
    _pdf = null,
    _numOfPages = 0,
    _dataChanged = !1,
    _completeBtnCallBack = null,
    VnptPdf = function (t) {
        var e = new function () {
            this.x = 0, this.y = 0, this.width = 0, this.height = 0, this.page = 1, this.fontSize = 8, this.imageSrc = "", this.rectangle = "", this.visibleType = SignatureVisibleType.BOTH, this.comments = [], this.comment = ""
        };

        function n(t) {
            var i = t.getViewport(1);
            _pageWidth = Math.floor(i.width), _pageHeight = Math.floor(i.height), console.log("width=" + _pageWidth + ". height=" + _pageHeight);
            var n = t.getViewport(1 / 72 * a()),
                s = document.getElementById("dropHere"),
                o = s.getContext("2d");
            s.height = n.height, s.width = n.width;
            var p = {
                canvasContext: o,
                viewport: n
            };
            t.render(p),
                function () {
                    _signBox = $("#dragThis"), _pdfPage = $("#dropHere"), _signImage = $("#signature-img"), _signText = $("#signature-text"), _pdfPage.show(), $(".pdf-working-area").show();
                    var t = _pdfPage[0].offsetLeft,
                        i = _pdfPage[0].offsetTop;
                    0 == e.x && (e.x = 15);
                    0 == e.y && (e.y = _pageHeight - 15 - e.height);
                    var n = i + 9 - (e.y + e.height - _pageHeight);
                    _signBox.css({
                        top: n,
                        left: t + 9 + e.x,
                        position: "absolute"
                    }), $("#signature-img").attr("src", "data:image/png;base64," + e.imageSrc), $("#signbox-xpos").val(e.x), $("#signbox-ypos").val(e.y), _signBox.draggable({
                        containment: $("#dropHere"),
                        drag: function () {
                            var t = _pdfPage[0].offsetLeft,
                                i = _pdfPage[0].offsetTop,
                                n = _signBox[0].offsetTop,
                                s = _signBox[0].offsetLeft,
                                d = ($(this).offset(), Math.floor((s - t) / a() * 72));
                            e.x = d;
                            var o = Math.floor(_signBox[0].offsetHeight / a() * 72),
                                p = _pageHeight - Math.floor((n - i) / a() * 72) - o;
                            e.y = p, $("#signbox-xpos").val(d), $("#signbox-ypos").val(p)
                        },
                        stop: function () {
                            _pdfPage.offset().left, _pdfPage.offset().top;
                            var t = $(this).offset();
                            t.left, t.top
                        }
                    }).resizable({
                        resize: function (t, e) {
                            d($(this))
                        },
                        stop: function (t, e) {
                            d($(this))
                        }
                    }), $("#dropHere").droppable({
                        accept: "#dragThis",
                        over: function () {
                            $("#dragThis").draggable("option", "containment", $(this))
                        }
                    }), window.addEventListener("resize", function () {
                        var t = _pdfPage[0].offsetLeft,
                            i = _pdfPage[0].offsetTop,
                            n = Math.floor(_signBox[0].offsetHeight / a() * 72),
                            s = t + e.x * a() / 72,
                            d = (_pageHeight - n - e.y) * a() / 72 + i;
                        _signBox.css({
                            left: s,
                            top: d
                        })
                    }), $("input[type=radio][name=sign-visible-type]").change(function () {
                        var t = $(this).val();
                        switch (t) {
                            case "1":
                                e.visibleType = SignatureVisibleType.ONLY_TEXT, _signImage.hide(), _signText.removeAttr("style"), _signText.css({
                                    width: "100%"
                                });
                                break;
                            case "2":
                                e.visibleType = SignatureVisibleType.BOTH, _signImage.removeAttr("style"), _signText.removeAttr("style"), _signText.css({
                                    width: "50%"
                                });
                                break;
                            default:
                                e.visibleType = SignatureVisibleType.ONLY_IMAGE, _signText.hide(), _signImage.removeAttr("style"), _signImage.css({
                                    margin: "0px auto",
                                    float: "unset",
                                    width: "100%"
                                }), _signImage.show()
                        }
                    })
                }(), $(".sign-pos").bind("cut copy paste drag drop", function (t) {
                    t.preventDefault()
                })
        }

        function a() {
            return document.getElementById("dpi").offsetWidth
        }

        function s() {
            var t = e.comments.length,
                i = "#comment" + t,
                n = $("#comment-text").val();
            if ("" != n) {
                var s = $("#comment-text-page").val();
                if (isNaN(s) || s < 1 || s > _numOfPage) alert("Trang thêm comment không hợp lệ. (Số trang từ 1 đến " + _numOfPage + ")");
                else {
                    var d = "<tr><td>" + (t + 1) + '.</td><td><span class="pdf-size-lbl">Nội dung</span></td><td><input id="comment-text-' + t + '" class="sign-pos" type="text" value="' + n + '" /></td > <td><span class="pdf-size-lbl">Page </span></td> <td><input id="comment-text-page-' + t + '" class="sign-pos" value="' + s + '" type="text" /></td></tr >';
                    $("#pdf-comments-table").append(d), $("#comment-text-" + t).keyup(function () {
                        var i, n;
                        i = t, n = $("#comment-text-" + i).val(), e.comments[i].text = n, $("#comment-val-" + i).text(n)
                    }), $(".pdf-page").append('<div id="comment' + t + '" class="pdf-comment"><span id="comment-val-' + t + '">' + n + "</span></div>"), $("#comment-text").val("");
                    var p = new function () {
                        this.x = 0, this.y = 0, this.width = 0, this.height = 0, this.page = 1, this.rectangle = "", this.page = 1
                    };
                    p.text = n, p.page = s, e.comments.push(p),
                        function (t, i) {
                            var n = $(i),
                                s = _pdfPage[0].offsetLeft,
                                d = (_pdfPage[0].offsetTop, s + 21),
                                p = _pageHeight - 15 - 250;
                            n[0].offsetLeft;
                            e.comments[t].x = 9, e.comments[t].y = 450, e.comments[t].width = 120, e.comments[t].height = 20, n.css({
                                top: p,
                                left: d,
                                position: "absolute"
                            }), n.draggable({
                                containment: $("#dropHere"),
                                drag: function () {
                                    var i = _pdfPage[0].offsetLeft,
                                        s = _pdfPage[0].offsetTop,
                                        d = n[0].offsetTop,
                                        o = n[0].offsetLeft,
                                        p = ($(this).offset(), Math.floor((o - i) / a() * 72));
                                    e.comments[t].x = p - 6;
                                    var g = Math.floor(n[0].offsetHeight / a() * 72),
                                        l = _pageHeight - Math.floor((d - s) / a() * 72) - g + 6;
                                    e.comments[t].y = l
                                },
                                stop: function () {
                                    _pdfPage.offset().left, _pdfPage.offset().top;
                                    var t = $(this).offset();
                                    t.left, t.top
                                }
                            }).resizable({
                                resize: function (e, i) {
                                    o(t, $(this))
                                },
                                stop: function (e, i) {
                                    o(t, $(this))
                                }
                            }), $("#dropHere").droppable({
                                accept: i,
                                over: function () {
                                    n.draggable("option", "containment", $(this))
                                }
                            })
                        }(t, i)
                }
            } else alert("Chưa nhập nội dung comment.")
        }

        function d(t) {
            var i = Math.floor(t[0].offsetWidth / a() * 72),
                n = Math.floor(t[0].offsetHeight / a() * 72);
            e.width = i, e.height = n, $("#signbox-width").val(i), $("#signbox-height").val(n)
        }

        function o(t, i) {
            var n = Math.floor(i[0].offsetWidth / a() * 72),
                s = Math.floor(i[0].offsetHeight / a() * 72);
            e.comments[t].width = n, e.comments[t].height = s
        }

        function p() {
            $("#pdf-sign-page-btn").click(function () {
                var t = Number($("#pdf-sign-page").val());
                isNaN(t) || t < 1 || t > _numOfPage ? alert("Trang đặt chữ ký không hợp lệ. (Số trang từ 1 đến " + _numOfPage + ")") : (e.page = t, _pdf.getPage(e.page).then(function (t) {
                    n(t)
                }))
            }), $("#pdf-sign-font-btn").click(function () {
                var t = Number($("#pdf-sign-font").val());
                if (isNaN(t) || t < 1 || t > 20) alert("Cỡ chữ không hợp lệ. (Cỡ chữ hợp lệ từ 1 đến 20)");
                else {
                    e.fontSize = t;
                    var i = Math.floor(t * a() / 72),
                        n = i + "px",
                        s = i + 1 + "px";
                    $("#signature-text span").css({
                        "font-size": n,
                        "line-height": s
                    })
                }
            })
        }

        function g() {
            $(document).on("change", "#pdf-sign-image-file :file", function (t) {
                if ($(this).get(0).files) {
                    var i = $(this),
                        n = (i.get(0).files && i.get(0).files.length, i.val().replace(/\\/g, "/").replace(/.*\//, ""));
                    $("#pdf-sign-img-name").val(n);
                    var a = i.get(0).files[0],
                        s = new FileReader;
                    s.addEventListener("load", function () {
                        var t = ("" + this.result).substr(0, ("" + this.result).indexOf("base64,") + 7);
                        e.imageSrc = this.result.replace(t, ""), $("#signature-img").attr("src", this.result)
                    }), a && s.readAsDataURL(a)
                }
            })
        }
        return e.x = 0, e.y = 0, e.width = 250, e.height = 60, t.initPlugin = function () {
            $("body").append(pdfWorkingArea), $("#pdf-complete").click(function () {
                $(".pdf-working-area").hide(), _completeBtnCallBack()
            }), $("#pdf-cancel").click(function () {
                $(".pdf-working-area").hide()
            })
        }, t.initData = function (t, i) {
            null != e.imageSrc && "" != e.imageSrc || (e.imageSrc = _defaultImage), _completeBtnCallBack = i;
            var n = new FileReader;
            n.onload = function () {
                var t = new Uint8Array(this.result);
                PDFJS.getDocument(t).then(function (t) {
                    _pdf = t, _numOfPage = t.numPages, $("#pdf-total-pages").text(" of " + t.numPages), t.getPage(1).then(function (t) {
                        e.page = 1
                    })
                }), p(), g(), _dataChanged = !0, $("#add-comment-btn").click(function () {
                    s()
                })
            }, n.readAsArrayBuffer(t)
        }, t.initDataBase64 = function (t, n) {
            null != e.imageSrc && "" != e.imageSrc || (e.imageSrc = _defaultImage), _completeBtnCallBack = n;
            var a = function (t) {
                var e = window.atob(t),
                    n = e.length,
                    a = new Uint8Array(new ArrayBuffer(n));
                for (i = 0; i < n; i++) a[i] = e.charCodeAt(i);
                return a
            }(t);
            PDFJS.getDocument(a).then(function (t) {
                _pdf = t, _numOfPage = t.numPages, $("#pdf-total-pages").text(" of " + t.numPages), t.getPage(1).then(function (t) {
                    e.page = 1
                })
            }), p(), g(), _dataChanged = !0, $("#add-comment-btn").click(function () {
                s()
            })
        }, t.start = function () {
            _dataChanged ? (_dataChanged = !1, _pdf.getPage(e.page).then(function (t) {
                n(t)
            })) : $(".pdf-working-area").show()
        }, t.getPdfOptions = function () {
            e.rectangle = e.x + "," + e.y + "," + (e.x + e.width) + "," + (e.y + e.height), e.comment = "";
            for (var t = 0; t < e.comments.length; t++) e.comments[t].rectangle = e.comments[t].x + "," + e.comments[t].y + "," + (e.comments[t].x + e.comments[t].width) + "," + (e.comments[t].y + e.comments[t].height), e.comment += e.comments[t].text + ";" + e.comments[t].rectangle + ";" + e.comments[t].page + "-";
            return e.comment = e.comment.slice(0, -1), e
        }, t
    }(VnptPdf || {}),
    pdfWorkingArea = '<div id="dpi" style="height: 1in; left: -100%; position: absolute; top: -100%; width: 1in;"></div><div class="pdf-working-area">    <div class="pdf-action-menu">        <div class="pdf-action-menu-content">            <fieldset>                <legend>Vị trí chữ ký</legend>                <table>                    <tr>                        <td>                            <span class="pdf-size-lbl">X Pos = </span>                        </td>                        <td>                            <input class="sign-pos" id="signbox-xpos" type="text" value="15" disabled />                        </td>                        <td>                            <span class="pdf-size-lbl">  Y Pos = </span>                        </td>                        <td>                            <input class="sign-pos" id="signbox-ypos" type="text" value="765" disabled />                        </td>                    </tr>                    <tr>                        <td>                            <span class="pdf-size-lbl">Width = </span>                        </td>                        <td>                            <input class="sign-pos" id="signbox-width" type="text" value="200" disabled />                        </td>                        <td>                            <span class="pdf-size-lbl">  Height = </span>                        </td>                        <td>                            <input class="sign-pos" id="signbox-height" type="text" value="60" disabled />                        </td>                    </tr>                    <tr>                        <td> </td>                    </tr>                    <tr>                        <td colspan="4">                            <span>Trang chứa chữ ký:</span>                        </td>                    </tr>                    <tr>                        <td></td>                        <td>                            <input type="text" id="pdf-sign-page" value="1" />                        </td>                        <td>                            <span class="pdf-size-lbl pdf-all-page-lbl" id="pdf-total-pages"></span>                        </td>                        <td>                            <button class="pdf-btn" id="pdf-sign-page-btn" style="width: 70px;">Set</button>                        </td>                    </tr>                    <tr>                        <td> </td>                    </tr>                    <tr>                        <td colspan="4">                            <span>Cỡ chữ hiển thị: </span>                        </td>                    </tr>                    <tr>                        <td></td>                        <td>                            <input type="text" id="pdf-sign-font" value="8" />                        </td>                        <td> </td>                        <td>                            <button class="pdf-btn" id="pdf-sign-font-btn" style="width: 70px;">Set</button>                        </td>                    </tr>                </table>            </fieldset>            <fieldset>                <legend>Kiểu hiển thị chữ ký</legend>                <div>                    <input type="radio" name="sign-visible-type" value="1"> Chỉ hiển thị text<br />                    <input type="radio" name="sign-visible-type" value="2" checked> Hiển thị text và hình ảnh<br />                    <input type="radio" name="sign-visible-type" value="3"> Chỉ hiển thị hình ảnh<br />                </div>                <div>                    <br />                    <label>Tùy chọn hình hảnh</label>                    <div class="pdf-input-group">                        <input id="pdf-sign-img-name" type="text" class="pdf-file-name"                               readonly="readonly">                        <span class="pdf-input-group-btn">                            <span class="pdf-btn pdf-btn-file" id="pdf-sign-image-file">                                ... <input id="select-file" name="SetupFile" type="file"                                           accept="image/x-png,image/gif,image/jpeg" required>                            </span>                        </span>                    </div>                </div>            </fieldset>            <fieldset>                <legend>Thêm comments</legend>                <div class="pdf-input-group">                    <div class="pdf-size-row">                        <div id="pdf-comments">                            <table id="pdf-comments-table">                            </table>                            <br />                            <table>                                <tr>                                    <td>   </td>                                    <td>                                        <span class="pdf-size-lbl">Nội dung</span>                                    </td>                                    <td>                                        <input id="comment-text" class="sign-pos" type="text" />                                    </td>                                    <td>                                        <span class="pdf-size-lbl">Page </span>                                    </td>                                    <td>                                        <input id="comment-text-page" class="sign-pos" type="text" />                                    </td>                                </tr>                                <tr></tr>                                <tr>                                    <td colspan="4">                                        <button class="pdf-btn" id="add-comment-btn" style="width: 70px;margin-top: 10px;">Thêm</button>                                    </td>                                </tr>                            </table>                        </div>                    </div>                </div>            </fieldset>            <br />            <br />            <table>                <tr>                    <td>                        <button class="pdf-btn" id="pdf-complete">Ký dữ liệu</button>                    </td>                    <td>                        <button class="pdf-btn pdf-btn-error" id="pdf-cancel">Hủy</button>                    </td>                </tr>            </table>        </div>    </div>    <div class="pdf-page">        <canvas id="dropHere" class="pdf-viewport"></canvas>        <div id="dragThis">            <img id="signature-img" src="" />            <div id="signature-text">                <span>Ký bởi: Tên chủ chứng thư</span>                <br />                <span>Thời gian ký: dd/MM/yyyy</span>            </div>        </div>    </div></div>';